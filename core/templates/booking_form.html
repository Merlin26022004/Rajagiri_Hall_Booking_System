{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="container py-4">
    <h2 class="section-title mb-3">Book a Space</h2>

    <form method="post" class="space-card p-4">
        {% csrf_token %}

        <div class="mb-3">
            <label class="form-label fw-semibold">Select Space</label>
            <select name="space_id" id="spaceSelect" class="form-select" required>
                <option value="">-- Choose Space --</option>
                {% for space in spaces %}
                <option value="{{ space.id }}"
                    {% if selected_space and selected_space.id == space.id %}selected{% endif %}>
                    {{ space.name }} ({{ space.get_type_display }})
                </option>
                {% endfor %}
            </select>
        </div>

        <div class="mb-3">
            <label class="form-label fw-semibold">Date</label>
            <input type="date" name="date" id="dateInput" class="form-control" required>
            <small class="text-muted d-block mt-1">
                Same-day bookings allowed if time does not overlap.
            </small>
        </div>

        <div id="existingSlots" class="alert alert-info d-none"></div>

        <div class="row">
            <div class="col-md-6 mb-3">
                <label class="form-label fw-semibold">Start Time</label>
                <input type="time" name="start_time" class="form-control" required>
            </div>
            <div class="col-md-6 mb-3">
                <label class="form-label fw-semibold">End Time</label>
                <input type="time" name="end_time" class="form-control" required>
            </div>
        </div>

        <div class="mb-3">
            <label class="form-label fw-semibold">Expected Count</label>
            <input type="number" name="expected_count" class="form-control" required>
        </div>

        <div class="mb-3">
            <label class="form-label fw-semibold">Purpose</label>
            <textarea name="purpose" rows="2" class="form-control" required></textarea>
        </div>

        <div class="mb-4">
            <label class="form-label fw-semibold d-block">Required Facilities</label>
            <div class="card bg-light border-0">
                <div class="card-body p-3">
                    <div id="facilitiesContainer" class="row">
                        <p class="text-muted small mb-0 fst-italic">Select a space to see available equipment.</p>
                    </div>
                </div>
            </div>
        </div>

        {% if not user.is_staff %}
        <div class="mb-4 p-3 bg-light rounded border border-warning">
            <label for="faculty_in_charge" class="form-label fw-semibold text-dark">
                Faculty In-Charge (Required)
            </label>
            <input type="text" 
                   name="faculty_in_charge" 
                   id="faculty_in_charge" 
                   class="form-control" 
                   placeholder="Enter name of the Professor who approved this" 
                   required>
            <small class="text-muted d-block mt-1">
                Since you are a student, you must specify which faculty member gave you permission.
            </small>
        </div>
        {% endif %}

        <button class="btn btn-book px-4">Submit</button>
    </form>
</div>

<script src="{% static 'js/booking.js' %}"></script>

{% endblock %}