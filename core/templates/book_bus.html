{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-7">
            
            <div class="text-center mb-5">
                <h2 class="fw-bold text-dark">Transport Request</h2>
                <p class="text-muted">Submit a travel request for approval.</p>
            </div>

            <div class="card-google position-relative overflow-hidden">
                <div class="position-absolute top-0 start-0 w-100" style="height: 6px; background: linear-gradient(90deg, var(--rajagiri-maroon) 0%, var(--rajagiri-gold) 100%);"></div>

                <form method="post" class="mt-4" id="busForm">
                    {% csrf_token %}
                    
                    <div class="row g-4 mb-4">
                        <div class="col-md-4">
                            <label class="label-material">Passengers</label>
                            <div class="modern-input-group">
                                <i class="bi bi-people-fill modern-input-icon"></i>
                                <input type="number" id="headcountInput" name="headcount" placeholder="Ex. 45" min="1" required>
                            </div>
                        </div>

                        <div class="col-md-8">
                            <label class="label-material">Preferred Vehicle</label>
                            <div class="modern-input-group">
                                <i class="bi bi-bus-front modern-input-icon"></i>
                                <select name="bus_id" id="busSelect" required>
                                    <option value="" disabled selected>-- Enter Passengers First --</option>
                                    {% for bus in buses %}
                                    <option value="{{ bus.id }}" data-capacity="{{ bus.capacity }}" data-name="{{ bus.name }}">
                                        {{ bus.name }} ({{ bus.capacity }} Seats)
                                    </option>
                                    {% empty %}
                                    <option disabled>No buses available</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div id="busSuggestionText" class="form-text fw-bold mt-2" style="display:none; font-size: 0.85rem;"></div>
                        </div>
                    </div>

                    <div class="mb-4">
                        <label class="label-material">Destination</label>
                        <div class="modern-input-group">
                            <i class="bi bi-geo-alt-fill modern-input-icon"></i>
                            <input type="text" name="destination" placeholder="e.g. Infopark, Kakkanad" required>
                        </div>
                    </div>

                    <div class="section-divider"></div>

                    <div class="row g-4 mb-4">
                        <div class="col-md-12">
                            <label class="label-material">Date of Journey</label>
                            <div class="modern-input-group">
                                <i class="bi bi-calendar-event modern-input-icon"></i>
                                <input type="date" id="journeyDate" name="date" placeholder="Select Journey Date..." required>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <label class="label-material">Departs At</label>
                            <div class="modern-input-group">
                                <i class="bi bi-clock modern-input-icon"></i>
                                <input type="time" id="startTime" name="start_time" placeholder="Select Departure..." required>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <label class="label-material">Returns At</label>
                            <div class="modern-input-group">
                                <i class="bi bi-clock-history modern-input-icon"></i>
                                <input type="time" id="endTime" name="end_time" placeholder="Select Return..." required>
                            </div>
                        </div>
                    </div>

                    <div class="section-divider"></div>

                    <div class="mb-5">
                        <label class="label-material">Purpose of Visit</label>
                        <div class="modern-input-group align-items-start pt-3">
                            <i class="bi bi-card-text modern-input-icon mt-1"></i>
                            <textarea name="purpose" rows="3" placeholder="Describe the official purpose..." required></textarea>
                        </div>
                    </div>

                    <button type="submit" id="submitBtn" class="btn btn-google w-100 mb-3">
                        Submit Request
                    </button>
                    
                    <div class="text-center">
                        <a href="{% url 'bus_list' %}" class="text-decoration-none text-muted small fw-bold">Cancel</a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script src="{% static 'js/bus_booking.js' %}"></script>
{% endblock %}